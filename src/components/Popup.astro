---
/* Revised Popup: Fixed interaction blocking issues */
---

<div
  id="profit-popup-overlay"
  class="fixed inset-0 z-100 hidden items-center justify-center bg-primary-900/60 opacity-0 transition-opacity duration-500 backdrop-blur-sm px-4 py-8 overflow-y-auto"
  role="dialog"
  aria-modal="true"
>
  <div
    id="profit-popup-content"
    class="relative w-full max-w-2xl overflow-hidden rounded-xl bg-grey-50 shadow-2xl transition-transform duration-500 scale-95"
  >
    <button
      id="close-popup"
      class="absolute top-4 right-4 z-20 size-10 flex items-center justify-center rounded-full bg-grey-100 text-grey-600 hover:bg-grey-200 hover:text-primary-900 transition-colors cursor-pointer"
      aria-label="Close popup"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="size-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <div class="p-2 md:p-4">
      <div class="relative w-full min-h-[600px] flex items-center justify-center">
        <iframe
    src="https://api.msglink.cloud/widget/form/8As7Tl468YopNi5PJw9G"
    style="display:none;width:100%;height:100%;border:none;border-radius:3px"
    id="inline-8As7Tl468YopNi5PJw9G"
    data-layout="{'id':'INLINE'}"
    data-trigger-type="showAfter"
    data-trigger-value="15"
    data-activation-type="alwaysActivated"
    data-activation-value=""
    data-deactivation-type="deactivateAfter"
    data-deactivation-value="2"
    data-form-name="Lead Magnet Client"
    data-height="776"
    data-layout-iframe-id="inline-8As7Tl468YopNi5PJw9G"
    data-form-id="8As7Tl468YopNi5PJw9G"
    title="Lead Magnet Client"
        >
</iframe>
      </div>
    </div>
  </div>
</div>
<script src="https://api.msglink.cloud/js/form_embed.js" is:inline></script>

<script>
  const setupPopup = () => {
    const overlay = document.getElementById("profit-popup-overlay");
    const content = document.getElementById("profit-popup-content");
    const closeBtn = document.getElementById("close-popup");

    const showPopup = () => {
      // 1. Remove hidden so it exists in the layout
      overlay?.classList.remove("hidden");
      overlay?.classList.add("flex");

      // 2. Small delay to allow the 'hidden' removal to register before animating opacity
      setTimeout(() => {
        overlay?.classList.add("opacity-100");
        content?.classList.remove("scale-95");
        content?.classList.add("scale-100");
      }, 10);

      document.body.style.overflow = "hidden";
    };

    const hidePopup = () => {
      overlay?.classList.remove("opacity-100");
      overlay?.classList.add("opacity-0");
      content?.classList.add("scale-95");
      content?.classList.remove("scale-100");
      
      // Wait for transition to finish before adding 'hidden' back
      setTimeout(() => {
        overlay?.classList.add("hidden");
        overlay?.classList.remove("flex");
      }, 500);

      document.body.style.overflow = "";
    };

    setTimeout(showPopup, 5000);

    closeBtn?.addEventListener("click", hidePopup);
    overlay?.addEventListener("click", (e) => {
      if (e.target === overlay) hidePopup();
    });
  };

  setupPopup();
  document.addEventListener("astro:after-swap", setupPopup);
</script>